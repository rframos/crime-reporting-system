<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SafeCity SJDM | Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #343a40; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .login-card { width: 400px; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); background: white; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="login-card">
        <h3 class="text-center fw-bold mb-4" id="authTitle">SafeCity SJDM</h3>
        <form id="authForm">
            <div class="mb-3">
                <input type="text" name="username" class="form-control" placeholder="Username" required>
            </div>
            <div class="mb-3">
                <input type="password" name="password" class="form-control" placeholder="Password" required>
            </div>
            <div id="roleSelect" class="mb-3 hidden">
                <label class="form-label small">Select Role</label>
                <select name="role" class="form-select">
                    <option value="Resident">Resident</option>
                    <option value="Official">Barangay Official</option>
                    <option value="Police">Police Officer</option>
                    <option value="Admin">Admin</option>
                </select>
            </div>
            <button type="submit" id="authBtn" class="btn btn-primary w-100 mb-3">Login</button>
            <p class="text-center small"><a href="#" id="toggleAuth">Need an account? Register</a></p>
        </form>
    </div>

    <script>
        const toggleBtn = document.getElementById('toggleAuth');
        const roleSelect = document.getElementById('roleSelect');
        const authTitle = document.getElementById('authTitle');
        const authBtn = document.getElementById('authBtn');
        let isLogin = true;

        toggleBtn.onclick = (e) => {
            e.preventDefault();
            isLogin = !isLogin;
            authTitle.innerText = isLogin ? "SafeCity SJDM" : "Join SafeCity";
            authBtn.innerText = isLogin ? "Login" : "Register";
            toggleBtn.innerText = isLogin ? "Need an account? Register" : "Have an account? Login";
            roleSelect.classList.toggle('hidden', isLogin);
        };

        document.getElementById('authForm').onsubmit = function(e) {
            e.preventDefault();
            const url = isLogin ? '/api/login' : '/api/register';
            fetch(url, { method: 'POST', body: new FormData(this) })
            .then(res => res.json())
            .then(data => {
                if(data.status === 'success') {
                    if(isLogin) window.location.href = "/";
                    else { alert("Success! Please login."); toggleBtn.click(); }
                } else { alert(data.message); }
            });
        };
    </script>
</body>
</html>
